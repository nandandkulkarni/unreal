# How to Run the MetaHuman Animation Setup Script (STATUS: INITIAL RUN COMPLETE ✅)

## Quick Start (For MetaHuman "Pia")
The first run for MetaHuman **Pia** has been successfully completed. You can find the results in `/Game/MetaHumans/Pia/Animations/`.

1. **Open Unreal Engine** with your project
2. **Open Python Console**: `Tools → Python → Execute Python Script`
3. **Run this command**:
   ```python
   exec(open(r"c:\UnrealProjects\Coding\unreal\metahuman_manage\run_metahuman_setup.py").read())
   ```

### Method 2: Direct Execution

Run the auto script directly:
```python
exec(open(r"c:\UnrealProjects\Coding\unreal\metahuman_manage\metahuman_animation_setup_auto.py").read())
```

---

## What the Script Does

### ✅ Automated Steps (72% of work):

1. **Finds Assets**
   - **Manny Mesh**: Searches standard paths, then falls back to searching Asset Registry for any mesh with "Manny" (e.g., `SKM_Manny_Simple`).
   - **MetaHuman**: Finds body mesh for specific MetaHuman (e.g., "Pia").
   - **Animations**: automagically infers animation folder from mesh location or searches for them.

2. **Creates IK Retargeter**
   - Creates `RTG_Manny_To_Pia` asset
   - Sets source mesh (Manny)
   - Sets target mesh (MetaHuman)
   - Auto-generates IK Rigs

3. **Configures Retargeter**
   - Auto-maps all chains (spine, arms, legs, fingers)
   - Sets retarget root to "pelvis"
   - Configures root motion (Globally Scaled)
   - Sets FK/IK blend (legs=IK, arms/spine=FK)

4. **Retargets Animations**
   - Batch retargets all Manny animations
   - Saves to `/Game/MetaHumans/Pia/Animations/`

5. **Creates Animation Blueprint**
   - Duplicates `ABP_Manny` to `ABP_Pia`
   - Remaps skeleton to MetaHuman

### ❌ Manual Steps Required (28% of work):

After the script completes, you need to:

1. **Open Character Blueprint**
   - Path: `/Game/ThirdPerson/Blueprints/BP_ThirdPersonCharacter`

2. **Update Mesh Component**
   - Select "Mesh" component
   - Skeletal Mesh → Choose MetaHuman body mesh
   - Anim Class → Choose `ABP_Pia`

3. **Adjust Transform** (if needed)
   - Z-location: Lower mesh if feet don't align with capsule

4. **Compile & Save**
   - Click "Compile"
   - Click "Save"

5. **Test**
   - Click "Play" in editor
   - Test movement (WASD)
   - Verify animations work

---

## Script Versions

### Auto Version (Recommended) ⭐
- **File**: `metahuman_animation_setup_auto.py`
- **Confidence**: 95%
- **Pros**: Uses Unreal's auto-generation, more reliable
- **Cons**: Less control over IK Rig details

### Manual Version
- **File**: `metahuman_animation_setup_manual.py`
- **Confidence**: 80%
- **Pros**: Full control over IK Rig creation
- **Cons**: Hardcoded bone names, estimated A-pose rotations

See `SCRIPT_COMPARISON.md` for detailed comparison.

---

## Troubleshooting

### Script Errors

**"MetaHuman not found"**
- Ensure MetaHuman "Pia" is downloaded from Quixel Bridge
- Check path: `/Game/MetaHumans/Pia/`

**"Manny not found"**
- Ensure Third Person Template content is enabled
- Check path: `/Game/Characters/Mannequins/`

**"Chain mapping failed"**
- Open IK Retargeter manually
- Click "Auto-Map Chains" again
- Verify green checkmarks on all chains

### Animation Issues

**Animations look wrong**
- Open IK Retargeter: `/Game/MetaHumans/Pia/Animations/RTG_Manny_To_Pia`
- Check root motion settings
- Verify FK/IK blend settings

**Character doesn't animate**
- Verify ABP_Pia is assigned to Character Blueprint
- Check that skeleton was remapped correctly
- Open ABP_Pia and verify no errors

**Foot sliding**
- Adjust IK blend for legs (should be 1.0 for IK)
- Check root motion mode (should be "Globally Scaled")

---

## Custom Projects / FilmIK Support
The script now includes robust discovery logic to handle projects with non-standard folder structures (like **FilmIK**).

1. **Asset Registry Search**: If standard paths fail, it queries the Asset Registry.
   - Example: Found `SKM_Manny_Simple` when `SKM_Manny` was missing.
2. **Inferred Paths**: Animation folders are inferred from the mesh location.
3. **Fallback Animation Blueprints**: If `ABP_Manny` is missing, it looks for `ABP_Unarmed`.

**To run on a new custom project:**
Just ensure your assets are imported. The script will likely find them automatically.

---

## Advanced Usage

### For Different MetaHumans

To use with a different MetaHuman (e.g., "Ada"):

1. Edit the script file
2. Change `METAHUMAN_NAME = "Pia"` to `METAHUMAN_NAME = "Ada"`
3. Run the script

### Custom Animation Sets

To retarget different animations:

1. Edit the `SOURCE_ANIMATION_PATH` variable
2. Point to your custom animation folder
3. Run the script

---

## Output Files

After running, you'll find these new assets:

### IK Retargeter
- **Path**: `/Game/MetaHumans/Pia/Animations/RTG_Manny_To_Pia`
- **Type**: IK Retargeter
- **Purpose**: Defines how to transfer animations

### Auto-Generated IK Rigs
- **Source**: `IK_AutoGeneratedSource` (for Manny)
- **Target**: `IK_AutoGeneratedTarget` (for MetaHuman)
- **Type**: IK Rig
- **Purpose**: Define bone chains and retarget settings

### Retargeted Animations
- **Path**: `/Game/MetaHumans/Pia/Animations/`
- **Files**: All Manny animations with "Pia" naming
- **Examples**:
  - `MM_Idle` → `MM_Idle_Pia`
  - `MM_Walk` → `MM_Walk_Pia`
  - `MM_Run` → `MM_Run_Pia`

### Animation Blueprint
- **Path**: `/Game/MetaHumans/Pia/Animations/ABP_Pia`
- **Type**: Animation Blueprint
- **Purpose**: Controls animation state machine for MetaHuman

---

## Documentation

- **`TUTORIAL_COMPLETE_ANALYSIS.md`** - Full 33-step tutorial breakdown
- **`SCRIPT_COMPARISON.md`** - Comparison of auto vs manual versions
- **`RETARGETING_REFERENCE.md`** - Technical reference

---

## Support

If you encounter issues:

1. Check the Unreal Output Log for errors
2. Review `TUTORIAL_COMPLETE_ANALYSIS.md` for manual steps
3. Verify all prerequisites are met (MetaHuman downloaded, etc.)
4. Try running individual sections of the script to isolate issues
